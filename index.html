<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Web of Things (WoT) Scripting API</title>
    <script src="https://www.w3.org/Tools/respec/respec-w3c-common" class="remove"></script>
    <script class='remove'>
      // See https://github.com/w3c/respec/wiki/ for how to configure ReSpec
      var respecConfig = {
        specStatus: "ED",
        shortName: "wot-scripting-api",
        copyrightStart:       2017,
        noLegacyStyle:        true,
        publishDate:          "",
        previousPublishDate:  "",
        previousMaturity:     "",
        edDraftURI:           "https://w3c.github.io/wot-scripting-api/",
        crEnd:                "",
        inlineCSS:            true,
        noIDLIn:              true,
        format:               'markdown',
        editors: [
          { name: "Zoltan Kis", company: "Intel", companyURL: "https://www.intel.com/" },
          { name: "Kazuaki Nimura", company: "Fujitsu Ltd.", companyURL: "https://www.fujitsu.com/" },
          { name: "Daniel Peintner", company: "Siemens AG", companyURL: "https://www.siemens.com/" },
          { name: "Johannes Hund", note: "Former Editor, when at Siemens AG" },
        ],
        wg:           "Web of Things Working Group",
        wgURI:        "https://www.w3.org/WoT/WG/",
        wgPublicList: "public-wot-wg",
        issueBase: "https://www.github.com/w3c/wot-scripting-api/issues/",
        githubAPI: "https://api.github.com/repos/w3c/wot-scripting-api",
        otherLinks: [
          {
            key: "Contributors",
            data: [
                {
                  value: "In the GitHub repository",
                  href: "https://github.com/w3c/wot-scripting-api/graphs/contributors"
                }
            ]
          },
          {
            key: "Repository",
            data: [{
                  value: "We are on GitHub",
                  href: "https://github.com/w3c/wot-scripting-api"
              }, {
                  value: "File a bug",
                  href: "https://github.com/w3c/wot-scripting-api/issues"
              },
            ]
          },
        ],
        localBiblio: {
          "WOT-ARCHITECTURE" : {
            href:"https://w3c.github.io/wot-architecture/",
            title: "Web of Things Architecture",
            publisher: "W3C",
            date: "20 August 2017"
          },
          "WOT-TD" : {
            href:"https://w3c.github.io/wot-thing-description/",
            title: "WoT Thing Description ",
            publisher: "W3C",
            date: "20 August 2017"
          },
          "WOT-PROTOCOL-BINDINGS" : {
            href:"https://w3c.github.io/wot-binding-templates/",
            title: "Web of Things Protocol Binding Templates",
            publisher: "W3C",
            date: "20 August 2017"
          },
          "WOT-PRACTICES": {
            href:"http://w3c.github.io/wot/current-practices/wot-practices.html",
            title: "Web of Things Current Practices",
            publisher: "W3C",
            date: "6 February 2017"
          },
          "TYPESCRIPT": {
            href:"https://github.com/Microsoft/TypeScript/blob/master/doc/spec.md",
            title: "TypeScript Language Specification",
            publisher: "Microsoft",
            date: "1 October 2012"
          },
          "WEBAPPSEC": {
            href:"https://w3c.github.io/webappsec/specs/powerfulfeatures",
            title: "Secure Contexts",
            publisher: "W3C",
            date: "17 July 2015"
          },
        },
      };
    </script>
  </head>
  <body>

  <section id="abstract">
    <p>
      The <a>Web of Things</a> (WoT) provides layered interoperability between <a>Things</a> by using the <a>WoT Interface</a>s.
    </p>
    <p>
      This specification describes a programming interface representing the <a>WoT Interface</a> that allows scripts run on a <a>Thing</a> to discover and consume (retrieve) other <a>Thing</a>s and to expose <a>Things</a> characterized by <a> WoT Interactions</a>, i.e. <a>Properties</a>, <a>Actions</a> and <a>Events</a>.
    </p>
    <p>
      Scripting is an optional "convenience" building block in WoT and it is typically used in gateways that are able to run a <a>WoT Runtime</a> and <a href="https://github.com/w3c/wot-scripting-api/tree/master/applications/script-manager">script management</a>, providing a convenient way to extend WoT support to new types of endpoints and implement WoT applications like <a href="https://github.com/w3c/wot-scripting-api/tree/master/applications/thing-directory">Thing Directory</a>.
    </p>
  </section>

  <section id="sotd">
    <p>
      Implementers need to be aware that this specification is considered unstable. Vendors interested in implementing this specification before it eventually reaches the Candidate Recommendation phase should subscribe to the [repository](https://github.com/w3c/wot-scripting-api) and take part in the discussions.
    </p>
    <p class="ednote" title="The W3C WoT WG is asking for feedback">
      Please contribute to this draft using the <a href="https://github.com/w3c/wot-scripting-api/issues">GitHub Issue</a> feature of the <a href="https://github.com/w3c/wot-scripting-api/">WoT Scripting API</a> repository.
      For feedback on security and privacy considerations, please use the <a href="https://github.com/w3c/wot-security/issues">WoT Security and Privacy</a> Issues.
    </p>
  </section>

  <section id="introduction"> <h2>Introduction</h2>
    <p>
      The overall WoT concepts are described in the [WoT Architecture](https://w3c.github.io/wot-architecture/) document.
      The Web of Things is made of entities (<a>Thing</a>s) that can describe their capabilities in a machine-interpretable format, the <a>Thing Description</a> (TD) and expose these capabilities through the <a>WoT Interface</a>. Support for scripting is optional for WoT devices.
    </p>
    <p>
      By <a>consuming a TD</a>, a client <a>Thing</a> creates a runtime resource model that allows accessing the <a>Properties</a>, <a>Actions</a> and <a>Events</a> exposed by the server <a>Thing</a>.
    </p>
    <p>
      Exposing a <a>Thing</a> requires defining a <a>Thing Description</a> (TD) and instantiating a software stack needed to serve requests for accessing the exposed <a>Properties</a>, <a>Actions</a> and <a>Events</a>. This specification describes how to expose and consume <a>Thing</a>s by a script.
    </p>
    <p class="note">
      Typically scripts are meant to be used on devices able to provide resources (with a <a>WoT interface</a>) for managing (installing, updating, running) scripts, such as bridges or gateways that expose and control simpler devices as WoT <a>Thing</a>s.
    </p>
    <p class="note">
      This specification does not make assumptions on how the <a>WoT Runtime</a> handles and runs scripts, including single or multiple tenancy, script deployment and lifecycle management. The API already supports the generic mechanisms that make it possible to implement script management, for instance by exposing a manager <a>Thing</a> whose <a>Actions</a> (action handlers) implement script lifecycle management operations.
    </p>
    <p>
      For an introduction on how scripts could be used in <a>Web of Things</a>, check the [Primer](https://w3c.github.io/wot-scripting-api/primer) document. For some background on API design decisions check the [Rationale](https://w3c.github.io/wot-scripting-api/rationale) document.
    </p>
  </section>

  <section class="informative"> <h3>Use Cases</h3>
    <p>
      The following scripting use cases are supported in this specification:
    </p>
    <section><h4>Discovery</h4>
    <ul>
      <li>Discover all <a>Thing</a>s in the WoT network by sending a broadcast request.</li>
      <li>Discover <a>Thing</a>s running in the local <a>WoT Runtime</a>.</li>
      <li>Discover nearby <a>Thing</a>s, for instance by NFC or Bluetooth.</li>
      <li>Discover <a>Thing</a>s by sending a discovery request to a given registry.</li>
      <li>Discover <a>Thing</a>s by filters defined on <a>Thing Description</a>s</li>
      <li>Discover <a>Thing</a>s by semantic filters.</li>
      <li>Stop or suppress an ongoing discovery process.</li>
      <li>
          Optionally specify a timeout to the discovery process after which it is stopped/suppressed.
      </li>
    </ul>
    </section>
    <section><h4>Consuming a Thing</h4>
    <ul>
      <li>
        Fetch a <a>Thing Description</a> of a <a>Thing</a> given its URL.
      </li>
      <li>
        <a>Consume a TD</a> of a <a>Thing</a>, including parsing the <a>TD</a> and generating the protocol bindings in order to access lower level functionality.
      </li>
      <li>On a consumed <a>Thing</a>,
        <ul>
          <li>Read the value of a <a>Property</a> or set of properties.</li>
          <li>Set the value of a <a>Property</a> or a set of properties.</li>
          <li>Observe value changes of a <a>Property</a>.</li>
          <li>Invoke an <a>Action</a>.</li>
          <li>Observe <a>Events</a> emitted by the <a>Thing</a>.</li>
          <li>Observe changes to the <a>Thing Description</a> of the <a>Thing</a>.</li>
          <li>Get the <a>Thing Description</a>.</li>
          <li>Get the list of linked resources based on the <a>Thing Description</a>.</li>
        </ul>
      </li>
    </ul>
    </section>
    <section><h4>Exposing a Thing</h4>
    <ul>
      <li>
        Exposing the <a>Thing</a> includes generating the protocol bindings in order to access lower level functionality.
      </li>
      <li>
        Create a local <a>ExposedThing</a> to be exposed, based on a <a>Thing Description</a> provided in string serialized format, or out of a template or an existing <a>ConsumedThing</a> object.</li>
      <li>Add a <a>Property</a> definition to the <a>Thing</a>.</li>
      <li>Add an <a>Action</a> definition to the <a>Thing</a>.</li>
      <li>Add an <a>Event</a> definition to the <a>Thing</a>.</li>
      <li>Attach semantic information to the <a>Thing</a>.</li>
      <li>Attach semantic information to a <a>Property</a>.</li>
      <li>Attach semantic information to an <a>Action</a>.</li>
      <li>Attach semantic information to an <a>Event</a>.</li>
      <li>
        Emit an <a>Event</a>, i.e. notify all listeners subscribed to that <a>Event</a>.
      </li>
      <li>
        Provide notifications for <a>TD</a> changes to clients subscribed to that.
      </li>
      <li>Mark/unmark the Thing to be discoverable.</li>
      <li>Mark/unmark the Thing to be consumable.</li>
      <li>Start the exposed <a>Thing</a> in order to process external requests.</li>
      <li>Stop the exposed <a>Thing</a>.</li>
      <li>Register handlers for external requests:
        <ul>
          <li>to retrieve a <a>Property</a> value;</li>
          <li>to update a <a>Property</a> value;</li>
          <li>
            to run an <a>Action</a>: take the parameters from the request, execute the defined action, and return the result;
          </li>
        </ul>
      </li>
    </ul>
    </section>
  </section>

  <section data-dfn-for="WoT">
    <h2>The <dfn>WoT</dfn> object</h2>
    <p>The WoT object is the API entry point and it is exposed by an implementation of the <a>WoT Runtime</a>. The <dfn>WoT object</dfn> does not expose properties, only methods for discovering, consuming and exposing a <a>Thing</a>.
    </p>
    <p class="note">
       Browser implementations SHOULD use a namespace object such as `wot`, and [Node.js](https://nodejs.org/en/)-like runtimes MAY provide the API object through the [`require()`](https://nodejs.org/api/modules.html) or [`import`](http://www.ecma-international.org/ecma-262/6.0/#sec-imports) mechanism.
    </p>
    <pre class="idl">
      // [SecureContext]
      // [NamespaceObject]
      interface WoT {
        Observable&lt;ConsumedThing&gt; discover(optional ThingFilter filter);
        Promise&lt;ThingDescription&gt; fetch(USVString url);
        ConsumedThing consume(ThingDescription td);
        ExposedThing produce(ThingModel model);
      };
      typedef USVString ThingDescription;
      typedef (ThingTemplate or ThingDescription) ThingModel;
    </pre>

    <p class="ednote">
      The algorithms for the WoT methods will be specified later, including error handling and security considerations.
    </p>

    <section> <h3>The <dfn>discover()</dfn> method</h3>
      <p>
        Starts the discovery process that will provide <code><a>ConsumedThing</a></code> objects that match the optional argument <code><a>ThingFilter</a></code>. When the argument is not provided, starts the widest discovery the <a>Thing Description</a> and <a>Protocol Bindings</a> allow and support.
        Returns an [<code>Observable</code>](https://github.com/tc39/proposal-observable) object that can be subscribed to and unsubscribed from.
      </p>

      <section data-dfn-for="DiscoveryMethod">
        <h4>The <dfn>DiscoveryMethod</dfn> enumeration</h4>
        <pre class="idl">
          typedef DOMString DiscoveryMethod;
        </pre>
        <p>
          <a>DiscoveryMethod</a> represents the discovery type to be used:
          <ul>
            <li><dfn>"any"</dfn> does not provide any restriction</li>
            <li><dfn>"local"</dfn> for discovering <a>Thing</a>s defined in the same device</li>
            <li>
              <dfn>"nearby"</dfn> for discovering <a>Thing</a>s nearby the device, e.g. by Bluetooth or NFC
            </li>
            <li>
              <dfn>"directory"</dfn> for discovery based on a service provided by a directory or repository of <a>Thing</a>s
            </li>
            <li>
              <dfn>"broadcast"</dfn> for an open ended discovery based on sending a request to a broadcast address
            </li>
            <li>
              <dfn>"other"</dfn> for a proprietary method defined by the solution.
            </li>
          </ul>
        </p>
      </section>

      <section data-dfn-for="ThingFilter">
        <h4>The <dfn>ThingFilter</dfn> dictionary</h4>
        <p>
          The <a>ThingFilter</a> dictionary that represents the constraints for discovering <a>Thing</a>s as key-value pairs.
        </p>
        <pre class="idl">
          dictionary ThingFilter {
            DiscoveryMethod method = "any";
            USVString url;
            USVString query;
            sequence&lt;Dictionary&gt; constraints;
          };
        </pre>
        <p>
          The <dfn>method</dfn> property represents the discovery type that should be used in the discovery process. The possible values are defined by the <code><a>DiscoveryMethod</a></code> enumeration that can be extended by string values defined by solutions (with no guarantee of interoperability).
        </p>
        <p class="ednote">
          The <a>DiscoveryMethod</a> enumeration can be extended by the <a>Thing Description</a> with values that are not specified here. This extensibility of <a>DiscoveryMethod</a> by proprietary or private methods is a working assumption until consensus is formed and may be removed later.
        </p>
        <p>
          The <dfn>url</dfn> property represents additional information for the discovery method, such as the URL of the target entity serving the discovery request, such as a <a>Thing Directory</a> or a Thing.
        </p>
        <p>
          The <dfn>query</dfn> property represents a query string accepted by the implementation, for instance a SPARQL query.
        </p>
        <p>
          The <dfn>constraints</dfn> property represents additional information for the discovery method in the form of a list of sets of property-value pairs (dictionaries). The list elements (dictionaries) are in OR relationship, and within a constraint dictionary the key-value pairs are in AND relationship. Implementations SHOULD make the following mapping from the constraint dictionaries to <a>SemanticAnnotations</a>: for each property-value pair in a constraint dictionary,
          <ul>
            <li>
              Each property name in the constraint dictionary SHOULD match the either the  `name` property of a defined <a>SemanticType</a> on the target <a>Thing</a> object, or the name of a <a>Property</a> on the target <a>Thing</a>.
            </li>
            <li>
              When the name matches, the values are compared. If the values match, the constraint is matched.
            </li>
          </ul>
        </p>
        <p class="ednote">
          Constraints are experimental feature, implementations are not required to support them.
        </p>
        <p class="ednote">
          Semantic annotations need revisiting in order to simplify their representation. In the [[WOT-TD]] specification they represent the `@type` construct. At the moment only `@context`, `@type` and `@id` constructs are used in the <a>TD</a>.
        </p>
      </section>
    </section> <!-- Discovery -->

    <section> <h3> The <dfn>fetch()</dfn> method</h3>
      <p>
        Accepts an <code>url</code> argument and returns a <code><a>Promise</a></code> that resolves with a <a>ThingDescription</a>.
      </p>
    </section>

    <section data-dfn-for="ThingDescription">
    <h3>The <dfn>ThingDescription</dfn> type</h3>
      <p>
        Representation of the <a>Thing Description</a>, standardized in the [Wot Things Description](https://w3c.github.io/wot-thing-description/) specification.
      </p>
      <p class="note">
        In this version of the API, <a>Thing Description</a>s are represented as opaque strings, denoting a serialized form, for instance JSON or JSON-LD. See [Issue 38](https://github.com/w3c/wot-scripting-api/issues/38) and [Issue 45](https://github.com/w3c/wot-scripting-api/issues/45).
      </p>
    </section>

    <section> <h3> The <dfn>consume()</dfn> method</h3>
      <p>
        Accepts an <code>td</code> argument of type <code><a>ThingDescription</a></code> and returns a <a>ConsumedThing</a> object instantiated based on that description.
      </p>
    </section>

    <section> <h3>The <dfn id="produce-method">produce()</dfn> method</h3>
      <p>
        Accepts a <code>model</code> argument of type <code><a>ThingModel</a></code> and returns an <a>ExposedThing</a> object, locally created based on the provided initialization parameters. An <a>ExposedThing</a> can be created in the following ways:
        <ol>
          <li>
            from an initial model (including a user given name and <a href="#the-semanticannotations-dictionary">semantic annotations</a>), then adding properties, actions, events and request handlers;
          </li>
          <li>
            from a <a>Thing Description</a> (possibly of a <a>ConsumedThing</a> object), then adding request handlers.
          </li>
        </ol>
      </p>
    </section> <!-- produce() -->

    <section data-dfn-for="ThingModel" >
    <h3>The <dfn>ThingModel</dfn> type</h3>
    <p>
      A Thing model is used for producing a new <a>ExposedThing</a> and can be either a <a>ThingTemplate</a>, or a <a>ThingDescription</a>.
    </p>
    </section>

    <section data-dfn-for="SemanticAnnotations" >
      <h3>The <dfn>SemanticAnnotations</dfn> dictionary</h3>
      <p>
        A dictionary that provides the semantic types and semantic metadata.
      </p>
      <pre class="idl">
        dictionary SemanticAnnotations {
            sequence&lt;SemanticType&gt; semanticType;
            sequence&lt;SemanticMetadata&gt; metadata;
        };
      </pre>
      <p>
        The <dfn>semanticType</dfn> property denotes a list of <a>SemanticType</a> objects that define the semantic types that can be used in semantic metadata type-value pairs.
      </p>
      <p>
        The <dfn>metadata</dfn> property denotes a list of <a>SemanticMetadata</a> objects (type-value pairs).
      </p>
    </section> <!-- SemanticAnnotations -->

    <section data-dfn-for="SemanticType" >
      <h3>The <dfn>SemanticType</dfn> dictionary</h3>
      <pre class="idl">
        dictionary SemanticType {
            required DOMString name;
            required USVString context;
            DOMString prefix;
        };
      </pre>
      <p>
        Represents a semantic type annotation, containing a name, a context and a prefix.
        <ul>
          <li>
            The <dfn>name</dfn> attribute represents the name of the semantic type in the given context.
          </li>
          <li>
            The <dfn>context</dfn> attribute represents an URL link to the context of the semantic classification.
          </li>
          <li>
            The <dfn>prefix</dfn> attribute represents a short prefix associated with a context.
          </li>
        </ul>
      </p>
      <p class="ednote">
        Semantic type examples to be added.
      </p>
    </section> <!-- SemanticType -->

    <section data-dfn-for="SemanticMetadata" >
      <h3>The <dfn>SemanticMetadata</dfn> dictionary</h3>
      <pre class="idl">
        dictionary SemanticMetadata {
            SemanticType type;
            any          value;
        };
      </pre>
      <p>The <a>SemanticMetadata</a> dictionary describes a pair of semantic type and value:
        <ul>
          <li>
            The <dfn>type</dfn> attribute represents the semantic type name defined by a <a>SemanticType</a> object.
          </li>
          <li>The <dfn>value</dfn> attribute represents the metadata value.</li>
        </ul>
      </p>
    </section> <!-- SemanticMetadata -->

    <section data-dfn-for="ThingTemplate" >
      <h3>The <dfn>ThingTemplate</dfn> dictionary</h3>
      <p>
        A Thing Template is a dictionary that provides a user given name, and the semantic types and semantic metadata attached to the <a>ExposedThing</a> <a>Thing Description</a>'s root level.
      </p>
      <pre class="idl">
        dictionary ThingTemplate: SemanticAnnotations {
            required DOMString name;
        };
      </pre>
      <p>The <a>ThingTemplate</a> dictionary extends <a>SemanticAnnotations</a> and contains properties to initialize a <a>Thing</a>:
        <ul>
          <li>
            The <dfn>name</dfn> attribute represents the user given name of the <a>Thing</a>.
          </li>
        </ul>
      </p>
      <p class="ednote">
        Support for configuration and security data might be added later.
      </p>
    </section> <!-- ThingTemplate -->

    <section> <h3>Examples</h3>
      <pre class="example" title="Discover Things via directory">
        let discoveryFilter = {
          method: "directory",
          url: "http://directory.wotservice.org"
        };
        let subscription = wot.discover(discoveryFilter).subscribe(
          thing => { console.log("Found Thing " + thing.name); },
          error => { console.log("Discovery finished because an error: " + error.message); },
          () => { console.log("Discovery finished successfully");}
        );
        setTimeout( () => {
            subscription.unsubscribe();
            console.log("Discovery timeout");
          },
          5000);
      </pre>
      <p class="note">
        Note that canceling a discovery (through `unsubscribe()`) may not be successful in all cases, for instance when discovery is based on open ended broadcast requests. However, once `unsubscribe()` has been called,  implementations MUST suppress further event handling ( i.e. further discoveries and errors) on the Observable. Also, a discovery error may not mean the end of the discovery process. However, in order to respect Observable semantics (error always terminates processing), implementations MUST close or suppress further event handling on the Observable.
      </p>
      <pre class="example" title="Discover Things exposed by local hardware">
        let subscription = wot.discover({ method: "local" }).subscribe(
          thing => { console.log("Found local Thing " + thing.name); },
          error => { console.log("Discovery error: " + error.message); },
          () => { console.log("Discovery finished successfully");}
        );
      </pre>
      <pre class="example" title="Same as above but with different Observable syntax">
        let subscription = wot.discover({ method: "local" }).subscribe({
          thing => { console.log("Found local Thing " + thing.name); },
          error: err => { console.log("Discovery error: " + err.message); },
          complete: () => { console.log("Discovery finished successfully");}
        });
      </pre>
      <pre class="example" title="Discover Things exposed nearby, via Bluetooth or NFC">
        let subscription = wot.discover({
          method: "nearby",
          constraints: [{ protocol: "BLE-4.2" }, { protocol: "NFC"}]
        }).subscribe(
          thing => { console.log("Found nearby Thing " + thing.name); },
          error => { console.log("Discovery error: " + error.message); },
          () => { console.log("Discovery finished successfully");}
        );
      </pre>
      <pre class="example" title="Discover Things exposed in a proprietary way">
        let subscription = wot.discover({
          method: "other",
          constraints: [{ solution: "XYZ123", key: "..."}]
        }).subscribe(
          thing => { console.log("Found Thing " + thing.name); },
          error => { console.log("Discovery error: " + error.message); },
          () => { console.log("Discovery finished successfully");}
        );
      </pre>
    </section> <!-- Examples -->
  </section> <!-- WoT API -->

  <section data-dfn-for="ConsumedThing">
    <h2>The <dfn>ConsumedThing</dfn> interface</h2>
    <p>
      The <a>ConsumedThing</a> interface is a client API for sending requests to servers in order to retrieve or update <a>Properties</a>, invoke <a>Actions</a>, and observe <a>Properties</a> and <a>Events</a>.
    </p>
    <pre class="idl">
      interface ConsumedThing {
        readonly attribute DOMString name;
        ThingDescription getThingDescription();
        Promise&lt;any&gt; readProperty(DOMString name);
        Promise&lt;void&gt; writeProperty(DOMString name, any value);
        Promise&lt;any&gt; invokeAction(DOMString name, any parameters);
        Observable onPropertyChange(DOMString name);
        Observable onEvent(DOMString name);
        Observable onTDChange();
      };
    </pre>
    <p>
      <code>ConsumedThing</code> represents a local proxy object of the remote <a>Thing</a>.
    </p>

    <section> <h3>The <dfn>name</dfn> property</h3>
      <p>
        The `name` property represents the name of the <a>Thing</a> as specified in the <a>TD</a>. In this version it is read only.
      </p>
    </section>
    <section> <h3>The <dfn>getThingDescription()</dfn> method</h3>
      <p>
        Returns the <a>Thing Description</a> of the <a>Thing</a>.
      </p>
      <p class="ednote">
        In this version, introspection based on <a>TD</a> is out of scope. Parsing and exposing <a>Thing Description</a>s is discussed in [Issue 38](https://github.com/w3c/wot-scripting-api/issues/38).
      </p>
    </section>

    <section> <h3>The <dfn>readProperty()</dfn> method</h3>
      <p>
        Takes the <a>Property</a> name as the <var>name</var> argument, then requests from the underlying platform  and the <a>Protocol Bindings</a> to retrieve the <a>Property</a> on the remote <a>Thing</a> and return the result. Returns a <code><a>Promise</a></code> that resolves with the <a>Property</a> value or rejects with an <a>Error</a>.
      </p>
    </section>

    <section> <h3>The <dfn>writeProperty()</dfn> method</h3>
      <p>
        Takes the <a>Property</a> name as the <var>name</var> argument and the new value as the <var>value</var> argument, then requests from the underlying platform and the <a>Protocol Bindings</a> to update the <a>Property</a> on the remote <a>Thing</a> and return the result. Returns a <code><a>Promise</a></code> that resolves on success or rejects with an <a>Error</a>.
      </p>
    </section>

    <section> <h3>The <dfn>invokeAction()</dfn> method</h3>
      <p>
        Takes the <a>Action</a> name from the <var>name</var> argument and the list of parameters, then requests from the underlying platform and the <a>Protocol Bindings</a> to invoke the <a>Action</a> on the remote <a>Thing</a> and return the result. Returns a <code><a>Promise</a></code> that resolves with the return value or rejects with an <a>Error</a>.
      </p>
    </section>

    <section> <h3>The <dfn>onPropertyChange()</dfn> method</h3>
      <p>
        Returns an <a>Observable</a> for the <a>Property</a> specified in the <var>name</var> argument, allowing subscribing to and unsubscribing from notifications.
      </p>
      <p>
        The callback function passed to the <code>subscribe()</code> method when invoked on the returned observer will receive the new property value each time it is changed.
      </p>
    </section>

    <section> <h3>The <dfn>onEvent()</dfn> method</h3>
      <p>
        Returns an <a>Observable</a> for the <a>Event</a> specified in the <var>name</var> argument, allowing subscribing to and unsubscribing from notifications.
      </p>
      <p>
        The callback function passed to the <code>subscribe()</code> method when invoked on the returned observer will receive the event data each time the event is fired.
      </p>
    </section>

    <section> <h3>The <dfn>onTDChange()</dfn> method</h3>
      <p>
        Returns an <a>Observable</a>, allowing subscribing to and unsubscribing from notifications to the <a>Thing Description</a>.
      </p>
      <p>
        The callback function passed to the <code>subscribe()</code> method when invoked on the returned observer will receive the new <a>Thing Description</a> each time it is changed.
      </p>
    </section>

    <section>
      <h2>Examples</h2>
      <p>
        Below a <code><a>ConsumedThing</a></code> interface example is given.
      </p>
      <pre class="example" title="Consume a Thing">
        try {
          let td = await wot.fetch("http://mmyservice.org/mySensor");
          let thing = wot.consume(td);
          console.log("Thing " + thing.name + " has been consumed.");
          let subscription = thing.onPropertyChange("temperature")
            .subscribe(function(value) {
              console.log("Temperature + " has changed to " + value);
            });
          thing.invokeAction("startMeasurement", { units: "Celsius" })
            .then(() => { console.log("Temperature measurement started."); })
            .catch(e => {
               console.log("Error starting measurement.");
               subscription.unsubscribe();
             })
        } catch(error) {
          console.log("Error during fetch or consume: " + error.message);
        };
      </pre>
    </section> <!-- Examples -->
  </section> <!-- ConsumedThing -->

  <section data-dfn-for="ExposedThing">
    <h2>The <dfn>ExposedThing</dfn> interface</h2>
    <p>
      The <a>ExposedThing</a> interface is the server API that allows defining request handlers, properties, <a>Actions</a>, and <a>Events</a> to a <a>Thing</a>. It also implements the <a>ConsumedThing</a> interface. An <a>ExposedThing</a> is created by the <a href="#the-produce-method">produce()</a> method.
    </p>
    <p class="ednote">
      It is under consideration to use a constructor for <a>ExposedThing</a> instead of a factory method.
    </p>
    <pre class="idl">
      ExposedThing implements ConsumedThing;
      interface ExposedThing {
        // define how to expose and run the Thing
        Promise&lt;void&gt; start();
        Promise&lt;void&gt; stop();
        Promise&lt;void&gt; register(optional USVString directory);
        Promise&lt;void&gt; unregister(optional USVString directory);
        Promise&lt;void&gt; emitEvent(DOMString eventName, any payload);
        // define Thing Description modifiers
        ExposedThing addProperty(ThingProperty property);
        ExposedThing removeProperty(DOMString name);
        ExposedThing addAction(ThingAction action);
        ExposedThing removeAction(DOMString name);
        ExposedThing addEvent(ThingEvent event);
        ExposedThing removeEvent(DOMString name);
        // define request handlers
        ExposedThing setPropertyReadHandler(DOMString name, PropertyReadHandler readHandler);
        ExposedThing setPropertyWriteHandler(DOMString name, PropertyWriteHandler writeHandler);
        ExposedThing setActionHandler(DOMString name, ActionHandler action);
      };
      callback PropertyReadHandler = Promise&lt;any&gt;();
      callback PropertyWriteHandler = Promise&lt;void&gt;(any value);
      callback ActionHandler = Promise&lt;any&gt;(any parameters);
    </pre>

    <section> <h3>The <dfn>start()</dfn> method</h3>
      <p>
        Start serving external requests for the <a>Thing</a>.
      </p>
    </section>

    <section> <h3>The <dfn>stop()</dfn> method</h3>
      <p>
        Stop serving external requests for the <a>Thing</a>.
      </p>
    </section>

    <section> <h3>The <dfn>register()</dfn> method</h3>
      <p>
        Generates the <a>Thing Description</a> given the properties, <a>Actions</a> and <a>Event</a> defined for this object. If a <code>directory</code> argument is given, make a request to register the <a>Thing Description</a> with the given WoT repository by invoking its <code>register</code> <a>Action</a>.
      </p>
    </section>

    <section> <h3>The <dfn>unregister()</dfn> method</h3>
      <p>
        If a <code>directory</code> argument is given, make a request to unregister the <a>Thing Description</a> with the given WoT repository by invoking its <code>unregister</code> <a>Action</a>. Then, and in the case no arguments were provided to this function, stop the <a>Thing</a> and remove the <a>Thing Description</a>.
      </p>
    </section>

    <section> <h3>The <dfn>emitEvent()</dfn> method</h3>
      <p>
        Emits an the event initialized with the event name specified by the <code>eventName</code> argument and data specified by the <code>payload</code> argument.
      </p>
    </section>

    <section data-dfn-for="DataSchema">
      <h4>The <dfn>DataSchema</dfn> type</h4>
      <pre class="idl">
        typedef USVString DataSchema;
      </pre>
      <p>
        The <a>DataSchema</a> type represents a data type <a href="https://w3c.github.io/wot-thing-description/#dataschema">specified</a> in the <a>Thing Description</a> in a serialized form.
      </p>
      <p class="ednote">
        <a>DataSchema</a> is under development, currently it can denote any type supported by the <a>Thing Description</a> and the <a>WoT Runtime</a>.
      </p>
    </section>

    <section> <h3>The <dfn>addProperty()</dfn> method</h3>
      <p>
        Adds a <a>Property</a> defined by the argument and updates the <a>Thing Description</a>. Throws on error. Returns a reference to the same object for supporting chaining.
      </p>
      <section data-dfn-for="ThingProperty" data-link-for="ThingProperty">
        <h4>The <dfn>ThingProperty</dfn> dictionary</h4>
        <pre class="idl">
          dictionary ThingProperty: SemanticAnnotations {
            required DOMString name;
            required DataSchema schema;
            any value;
            boolean writable = false;
            boolean observable = false;
          };
        </pre>
        <p>
          Represents the <a>Thing</a> <a>Property</a> description.
          <ul>
            <li>The <dfn>name</dfn> attribute represents the name of the <a>Property</a>.</li>
            <li>
              The <dfn>schema</dfn> attribute represents the data type for the <a>Property</a> described by <a>DataSchema</a>.
            </li>
            <li>The <dfn>value</dfn> attribute represents the value of the <a>Property</a>.</li>
            <li>
              The <dfn>writable</dfn> attribute defines whether the <a>Property</a> can be updated. The default value is <code>false</code>.
            </li>
            <li>
              The <dfn>observable</dfn> attribute defines whether the <a>Property</a> changes can be observed by an external client. The default value is <code>false</code>.
            </li>
          </ul>
        </p>
      </section>
    </section> <!-- addProperty() -->

    <section> <h3>The <dfn>removeProperty()</dfn> method</h3>
      <p>
        Removes the <a>Property</a> specified by the <code>name</code> argument and updates the <a>Thing Description</a>. Throws on error. Returns a reference to the same object for supporting chaining.
      </p>
    </section>

    <section> <h3>The <dfn>addAction()</dfn> method</h3>
      <p>
        Adds an <a>Action</a> to the <a>Thing</a> object as defined by the <code>action</code> argument of type <a>ThingAction</a> and updates the <a>Thing Description</a>. Throws on error. Returns a reference to the same object for supporting chaining.
      </p>
      <section data-dfn-for="ThingAction">
        <h4>The <dfn>ThingAction</dfn> dictionary</h4>
        <pre class="idl">
          dictionary ThingAction: SemanticAnnotations {
            required DOMString name;
            DataSchema inputSchema;
            DataSchema outputSchema;
          };
      </pre>
      <p>
        The <a>ThingAction</a> dictionary describes the arguments and the return value.
        <ul>
          <li>The <dfn>name</dfn> attribute provides the <a>Action</a> name.</li>
          <li>The <dfn>inputSchema</dfn> attribute provides the description of the input arguments (argument list is represented by an object). If missing, it means the action does not accept arguments.</li>
          <li>The <dfn>outputSchema</dfn> attribute provides the description of the returned data. If missing, it means the action does not return data.</li>
        </ul>
      </p>
      </section>
    </section> <!-- addAction -->

    <section> <h3>The <dfn>removeAction()</dfn> method</h3>
      <p>
        Removes the <a>Action</a> specified by the <code>name</code> argument and updates the <a>Thing Description</a>. Throws on error. Returns a reference to the same object for supporting chaining.
      </p>
    </section>

    <section> <h3>The <dfn>addEvent()</dfn> method</h3>
      <p>
        Adds an event to the <a>Thing</a> object as defined by the <code>event</code> argument of type <a>ThingEvent</a> and updates the <a>Thing Description</a>. Throws on error. Returns a reference to the same object for supporting chaining.
      </p>
      <section data-dfn-for="ThingEvent">
        <h4>The <dfn>ThingEvent</dfn> dictionary</h4>
        <pre class="idl">
          dictionary ThingEvent: SemanticAnnotations {
            required DOMString name;
            DataSchema schema;
          };
        </pre>
        <ul>
          <li>The <dfn>name</dfn> attribute represents the event name.</li>
          <li>The <dfn>schema</dfn> attribute represents the type of the data that is attached to the event. If missing, it means the event does not carry data.</li>
        </ul>
      </section>
    </section>

    <section> <h3>The <dfn>removeEvent()</dfn> method</h3>
      <p>
        Removes the event specified by the <code>name</code> argument and updates the <a>Thing Description</a>. Returns a reference to the same object for supporting chaining.
      </p>
    </section>

    <section data-dfn-for="PropertyReadHandler">
      <h3>The <dfn>PropertyReadHandler</dfn> callback</h3>
      <p>
        A function that returns a Promise and resolves it with the value of the <a>Property</a> matching the <code>name</code> argument to the <code>setPropertyReadHandler</code> function, or rejects with an error if the property is not found or the value cannot be retrieved.
      </p>
    </section>

    <section data-dfn-for="PropertyWriteHandler">
      <h3>The <dfn>PropertyWriteHandler</dfn> callback</h3>
      <p>
        A function called with <code>value</code> as argument that returns a Promise which is resolved when the value of the <a>Property</a> matching the <code>name</code> argument to the <code>setPropertyReadHandler</code> function is updated with <code>value</code>, or rejects with an error if the property is not found or the value cannot be updated.
      </p>
      <p class="ednote">
        Note that this function is invoked by implementations before the property is updated, so the code in this callback function can invoke the <code>readProperty()</code> method to find out the old value of the property, if needed. Therefore the old value is not provided to this method.
      </p>
    </section>

    <section data-dfn-for="ActionHandler">
      <h3>The <dfn>ActionHandler</dfn> callback</h3>
      <p>
        A function called with a <code>parameters</code> dictionary argument assembled by the <a>WoT runtime</a> based on the <a>Thing Description</a> and the external client request. It returns a Promise that rejects with an error or resolves if the action is successful or ongoing (may also resolve with a control object such as an <a>Observable</a> for actions that need progress notifications or that can be canceled).
      </p>
    </section>

    <section> <h3>The <dfn>setPropertyReadHandler()</dfn> method</h3>
      <p>
        Takes <code>name</code> as string argument and <code>readHandler</code> as argument of type <a>PropertyReadHandler</a>. Sets the handler function for reading the specified <a>Property</a> matched by <code>name</code>. Throws on error. Returns a reference to the same object for supporting chaining.
      </p>
      <p>
         The <code>readHandler</code> callback function will implement reading a <a>Property</a> and SHOULD be called by implementations when a request for reading a <a>Property</a> is received from the underlying platform.
      </p>
      <p>
        There SHOULD be at most one handler for any given <a>Property</a> and newly added handlers replace the old handlers. If no handler is initialized for any given <a>Property</a>, implementations SHOULD implement a default property read handler.
      </p>
    </section>

    <section> <h3>The <dfn>setPropertyWriteHandler()</dfn> method</h3>
      <p>
        Takes <code>name</code> as string argument and <code>writeHandler</code> as argument of type <a>PropertyWriteHandler</a>. Sets the handler function for writing the specified <a>Property</a> matched by <code>name</code>. Throws on error. Returns a reference to the same object for supporting chaining.
      </p>
      <p>
        There SHOULD be at most one write handler for any given <a>Property</a> and newly added handlers replace the old handlers. If no write handler is initialized for any given <a>Property</a>, implementations SHOULD implement default property update and notifying observers on change.
      </p>
    </section>

    <section> <h3>The <dfn>setActionHandler()</dfn> method</h3>
      <p>
        Takes <code>name</code> as string argument and <code>action</code> as argument of type <a>ActionHandler</a>. Sets the handler function for the specified <a>Action</a> matched by <code>name</code>. Throws on error. Returns a reference to the same object for supporting chaining.
      </p>
      <p>
        If provided, this callback function will implement invoking an <a>Action</a> and SHOULD be called by implementations when a request for invoking a <a>Action</a> is received from the underlying platform. The callback will receive a <code>parameters</code> dictionary argument.
      </p>
      <p>
        There SHOULD be exactly one handler for any given <a>Action</a>. If no handler is initialized for any given <a>Action</a>, implementations SHOULD return error if the action is invoked by any client.
      </p>
    </section>

    <section>
      <h2>Examples</h2>
      <p>
        Below some <code><a>ExposedThing</a></code> interface examples are given.
      </p>

      <pre class="example highlight" title="Create a new blank exposed Thing">
        try {
          var thing = WoT.produce({ name: "tempSensor" });
          // manually add Interactions
          thing.addProperty({
            name: "temperature",
            value: 0.0,
            schema: '{ "type": "number" }'
            // use default values for the rest
          }).addProperty({
            name: "max",
            value: 0.0,
            schema: '{ "type": "number" }'
            // use default values for the rest
          }).addAction({
            name: "reset",
            // no input, no output
          }).addEvent({
            name: "onchange",
            schema: '{ "type": "number" }'
          });
          // add server functionality
          thing.setActionHandler("reset", () => {
            console.log("Resetting maximum");
            thing.writeProperty("max", 0.0);
          });
          thing.start().then(() => {
              thing.register();
          });
          // define Thing business logic
          setInterval( async () => {
            let mock = Math.random()*100;
            thing.writeProperty("temperature", mock);
            let old = await thing.readProperty("max");
            if (old < mock) {
              thing.writeProperty("max", mock);
              thing.emitEvent("onchange");
            }
          }, 1000);
        } catch (err) {
           console.log("Error creating ExposedThing: " + err);
        }
      </pre>

      <pre class="example highlight" title="Create a new exposed Thing from a Thing Description">
        let thingDescription = '{ "@context": [ "https://w3c.github.io/wot/w3c-wot-td-context.jsonld", "https://w3c.github.io/wot/w3c-wot-common-context.jsonld" ], "@type": [ "Thing", "Sensor" ], "name": "mySensor", "geo:location": "testspace", "interaction": [ { "@type": [ "Property", "Temperature" ], "name": "prop1", "schema": { "type": "number" }, "saref:TemperatureUnit": "degree_Celsius" } ] }';
        try {
          // note that produce() fails if thingDescription contains error
          let thing = WoT.produce(thingDescription);
          // Interactions were added from TD
          // WoT adds generic handler for reading any property
          // define a specific handler for one property
          let name = "examplePropertyName";
          thing.setPropertyReadHandler(name, () => {
            console.log("Handling read request for " + name);
            return new Promise((resolve, reject) => {
                let examplePropertyValue = 5;
                resolve(examplePropertyValue);
              },
              e => {
                console.log("Error");
              });
          });
          thing.start();
        } catch(err) {
           console.log("Error creating ExposedThing: " + err);
        }
      </pre>

      <pre class="example highlight" title="Create a new exposed Thing from a TD URI">
        // fetch an external TD, e.g., to set up a proxy for that Thing
        WoT.fetch("http://myservice.org/mySensor/description").then(td => {
          // WoT.produce() ignores instance-specific metadata (security, form)
          let thing = WoT.produce(td);
          // Interactions were added from TD
          // add server functionality
          // ...
        });
      </pre>
    </section> <!-- ExposedThing Examples -->
  </section> <!-- ExposedThing -->

  <section class="informative" data-dfn-for="ConsumedThing">
    <h2>Experimental extensions to the <strong>ConsumedThing</strong> interface</h2>
    <p>
      The <a>ThingDescription</a> related functionality, such as enumerating <a>Properties</a>, <a>Action</a>s, <a>Event</a>s and links (introspection) is an API extension that is out of scope for this specification. However, the draft interfaces are defined here for informative purposes.
    </p>
    <pre class="idl">
      partial interface ConsumedThing {
        sequence&lt;ThingProperty&gt; getProperties();
        sequence&lt;ThingAction&gt; getActions();
        sequence&lt;ThingEvent&gt; getEvents();
        sequence&lt;TDLink&gt; getLinks();
      };
    </pre>

    <section> <h3>The <dfn>getProperties()</dfn> method</h3>
      <p>
        Returns the list of <a>Properties</a> defined in the <a>Thing Description</a> of the <a>Thing</a> in the form of a list of <a>ThingProperty</a> objects.
      </p>
    </section>

    <section> <h3>The <dfn>getActions()</dfn> method</h3>
      <p>
        Returns the list of <a>Action</a>s defined in the <a>Thing Description</a> of the <a>Thing</a> in the form of a list of <a>ThingAction</a> objects.
      </p>
    </section>

    <section> <h3>The <dfn>getEvents()</dfn> method</h3>
      <p>
        Returns the list of <a>Event</a>s defined in the <a>Thing Description</a> of the <a>Thing</a> in the form of a list of <a>ThingEvent</a> objects.
      </p>
    </section>

    <section> <h3>The <dfn>getLinks()</dfn> method</h3>
      <p>
        Returns the list of linked resources in <a>Thing Description</a> of the <a>Thing</a> in the form of a list of <a>TDLink</a> objects.
      </p>
      <section data-dfn-for="TDLink" >
        <h4>The <dfn>TDLink</dfn> dictionary</h4>
        <p>
          Contains a hyperlink reference, a relation type and a media type.
        </p>
        <pre class="idl">
          dictionary TDLink {
              required USVString href;
              USVString mediaType;
              DOMString rel;
          };
        </pre>
        <p>The <a>TDLink</a> dictionary contains the following properties:
          <ul>
            <li>
              The <dfn>href</dfn> attribute represents a <a>hyperlink reference</a>.
            </li>
            <li>
              The <dfn>rel</dfn> attribute represents a <a>relation type</a>.
            </li>
            <li>
              The <dfn>mediaType</dfn> attribute represents a <a>IANA media type</a>. For <a>TD</a>s there will be registered media types, so applications will be able to check whether an `href` link points to a <a>TD</a>, i.e. whether the link is fetcheable with this API.
            </li>
          </ul>
        </p>
      </section> <!-- TDLink -->
    </section>
  </section>

  <section data-dfn-for="Observable" class="informative">
    <h2>Observables</h2>
    <p>
      <dfn>Observables</dfn> are <a href="https://github.com/tc39/proposal-observable">proposed</a> to be included in ECMAScript and are used for handling pushed data associated with various possible sources, for instance events, timers, streams, etc. A minimal required implementation is described here.
    </p>
    <p class="ednote">
      This section is informal and contains rather laconic information for implementations on what to support for interoperability.
    </p>
    <pre class="idl">
      interface Observable {
        Subscription subscribe((Observer or OnNext) next,
                               optional OnError error,
                               optional OnComplete complete);
      };
      interface Subscription {
        void unsubscribe();
        readonly attribute boolean closed;
      };
      interface Observer {
        void next(any value);
        void error(Error error);
        void complete();
      };
      callback OnNext = void (any value);
      callback OnError = void (Error error);
      callback OnComplete = void ();
    </pre>

    <section data-dfn-for="Observer">
      <h3>The <dfn>Observer</dfn> interface</h3>
      <p>
        The <a>Observer</a> interface defines the callbacks needed to handle an <a>Observable</a>:
        <ul>
          <li>
            The <dfn>next()</dfn> function, as well as the <dfn>OnNext</dfn> callback takes the next sample for the data in the <dnf>value</dnf> argument.
          </li>
          <li>
            The <dfn>error()</dfn> function, as well as the <dfn>OnError</dfn> callback takes an error in the <dnf>value</dnf> argument. It is called when an error occured in producing the data the client should know about.
          </li>
          <li>
            The <dfn>complete()</dfn> function, as well as the <dfn>OnComplete</dfn> callback is called when the data source has finished sending values.
          </li>
        </ul>
      </p>
    </section>

    <section data-dfn-for="Subscription">
      <h3>The <dfn>Subscription</dfn> interface</h3>
      <p>
        Contains the <dfn>closed</dfn> property of type <code>boolean</code> that tells if the subscription is closed or active.
      </p>
      <p>
        Also, contains the <dfn>unsubscribe</dfn>() method that cancels the subscription, i.e. makes a request to the underlying platform to stop receiving data from the source, and sets the <code>closed</code> property to <code>false</code>.
      </p>
    </section>

    <section data-dfn-for="Observable">
      <h3>The <dfn data-dfn-for="">Observable</dfn> interface</h3>
      <p>
        The <a>Observable</a> interface enabled subscribing to pushed data notifications by the <dfn>subscribe</dfn>() method:
        <ul>
          <li>
            If the <code>subscribe()</code> method is called with an <a>Observer</a> object, initialize the data, error and completion handling callbacks from that object, or throw on error.
          </li>
          <li>
            Otherwise, if the <code>subscribe()</code> method is called with a function, initialize the data handler callback with that function. If the next argument is provided and is a function, initialize the error handling callback with that function, or throw on error. If the third argument is provided and is a function, initialize the completion handler with that function, or throw on error.
          </li>
          <li>
            After callback initializations, the implementation should request the underlying platform to provide data, error and completion notifications for the supported data source.
          </li>
        </ul>
    </section>
  </section> <!-- Observables -->

  <section> <h2 id="security">Security and Privacy</h2>
    <p class="ednote">
     Please see the <a href="https://github.com/w3c/wot-security/">WoT Security and Privacy</a> repository for work in progress regarding threat models, assets, risks, recommended mitigations, and best practices for security and privacy for systems using the Web of Things. Once complete, security and privacy considerations relevant to the Scripting API will be summarized in this section.
    </p>
  </section>

  <section> <h2>Terminology and conventions</h2>
    <p>
      The generic WoT terminology is defined in [[!WOT-ARCHITECTURE]]: <dfn data-lt="Things">Thing</dfn>, <dfn data-lt="Thing Descriptions">Thing Description</dfn> (in short <dfn>TD</dfn>), <dfn>Web of Things</dfn> (in short <b><i>WoT</i></b>),  <dfn>WoT Interface</dfn>, <dfn>Protocol Bindings</dfn>, <dfn>WoT Runtime</dfn>, <dfn data-lt="consume|consume a TD|consuming a TD">Consuming a Thing Description</dfn>, <dfn>Thing Directory</dfn>, <dfn>WoT Interactions</dfn>, <dfn data-lt="Properties">Property</dfn>, <dfn data-lt="Actions">Action</dfn>, <dfn data-lt="Events|WoT-Event">Event</dfn> etc.
    </p>
    <p>
      <dfn>JSON-LD</dfn> is defined in [[!JSON-LD]] as a JSON document that is augmented with support for Linked Data by providing a <code>@context</code> property with a defining URI .
      </dd>
    </p>
    <p>
      The terms <a href="http://www.w3.org/TR/url-1/"><dfn>URL</dfn></a> and
      <a href="https://url.spec.whatwg.org/#concept-url-path">
      <dfn>URL path</dfn></a> are defined in [[!URL]].
    </p>
    <p>
      The following terms are defined in [[!HTML5]] and are used in the context of browser implementations:
      <a href="https://html.spec.whatwg.org/multipage/browsers.html#browsing-context">
      <dfn>browsing context</dfn></a>,

      <a href="https://html.spec.whatwg.org/#top-level-browsing-context">
      <dfn>top-level browsing context</dfn></a>,

      <a href="https://html.spec.whatwg.org/multipage/webappapis.html#global-object">
      <dfn>global object</dfn></a>,

      <a href="http://www.w3.org/TR/html5/webappapis.html#incumbent-settings-object">
      <dfn>incumbent settings object</dfn></a>,

      <a href="https://html.spec.whatwg.org/#document">
      <dfn>Document</dfn></a>,

      <a href="http://www.w3.org/TR/2011/WD-html5-20110113/urls.html#document-base-url">
      <dfn>document base URL</dfn></a>,

      <a href="https://html.spec.whatwg.org/#window">
      <dfn>Window</dfn></a>,

      <a href="https://html.spec.whatwg.org/#windowproxy">
      <dfn>WindowProxy</dfn></a>,

      <a href="https://html.spec.whatwg.org/#origin">
      <dfn>origin</dfn></a>,

      <a href="https://html.spec.whatwg.org/#ascii-serialisation-of-an-origin">
      <dfn>ASCII serialized origin</dfn></a>,

      executing algorithms <a href="https://html.spec.whatwg.org/#in-parallel">
      <dfn>in parallel</dfn></a>,

      <a href="https://html.spec.whatwg.org/#queue-a-task">
      <dfn>queue a task</dfn></a>,

      <a href="https://html.spec.whatwg.org/#task-source">
      <dfn>task source</dfn></a>,

      <a href="https://html.spec.whatwg.org/#the-iframe-element">
      <dfn>iframe</dfn></a>,

      <a href="https://html.spec.whatwg.org/#valid-mime-type">
      <dfn>valid MIME type</dfn></a>.
    </p>
    <p>
      A <a>browsing context</a> refers to the environment in which
      <a>Document</a> objects are presented to the user. A given
      <a>browsing context</a> has a single <code><a>WindowProxy</a></code> object,
      but it can have many <code><a>Document</a></code> objects, with their associated
      <code><a>Window</a></code> objects. The <a>script execution context</a>
      associated with the <i>browsing context</i> identifies the entity which
      invokes this API, which can be a <i>web app</i>, a <i>web page</i>, or an
      <a>iframe</a>.
    </p>
    <p>
      The term
      <a href="https://w3c.github.io/webappsec/specs/powerfulfeatures/#secure-context">
      <dfn>secure context</dfn></a> is defined in [[!WEBAPPSEC]].
    </p>
    <p>
      <a href="https://tc39.github.io/ecma262/#sec-error-objects">
      <dfn>Error</dfn>, <dfn>EvalError</dfn>, <dfn>RangeError</dfn>, <dfn>ReferenceError</dfn>, <dfn>SyntaxError</dfn>, <dfn>TypeError</dfn>, <dfn>URIError</dfn>
      </a>,
      <a href="https://tc39.github.io/ecma262/#sec-execution-contexts">
        <dfn>script execution context</dfn></a>,
      <a href="http://www.ecma-international.org/ecma-262/6.0/#sec-promise-objects">
        <dfn>Promise</dfn></a>,
      <a href="http://www.ecma-international.org/ecma-262/6.0/#sec-json-object">
        <dfn>JSON</dfn></a>,
      <a href="http://www.ecma-international.org/ecma-262/6.0/#sec-json.stringify">
        <dfn>JSON.stringify</dfn></a> and
      <a href="http://www.ecma-international.org/ecma-262/6.0/#sec-json.parse">
        <dfn>JSON.parse</dfn></a>
      are defined in [[!ECMASCRIPT]].
    </p>
    <p>
      <a href="http://heycam.github.io/webidl/#idl-DOMString"><dfn>DOMString</dfn></a>,
      <a href="https://heycam.github.io/webidl/#idl-USVString"><dfn>USVString</dfn></a>,
      <a href="http://heycam.github.io/webidl/#idl-ArrayBuffer"><dfn>ArrayBuffer</dfn></a>,
      <a href="http://heycam.github.io/webidl/#common-BufferSource"><dfn>BufferSource</dfn></a> and
      <a href="http://heycam.github.io/webidl/#idl-any"><dfn>any</dfn></a> are defined in [[!WEBIDL]].
    </p>
    <p>
      The algorithms <a href="http://www.w3.org/TR/encoding/#utf-8-encode">
      <dfn>utf-8 encode</dfn></a>, and
      <a href="http://www.w3.org/TR/encoding/#utf-8-decode">
      <dfn>utf-8 decode</dfn></a> are defined in [[!ENCODING]].
    </p>
    <p>
      <dfn>IANA media type</dfn>s (formerly known as MIME types) are defined in
      <a href="http://tools.ietf.org/html/rfc2046">RFC2046</a>.
    </p>
    <p>
      The terms <dfn>hyperlink reference</dfn> and <dfn>relation type</dfn> are defined in [[!HTML5]] and <a href="https://tools.ietf.org/html/rfc8288">RFC8288</a>.
    </p>
  </section>

  <section id="conformance">
    <p>
      This document defines conformance criteria that apply to a single product: the <dfn>UA</dfn> (user agent) that implements the interfaces it contains.
    </p>
    <p>
      This specification can be used for implementing the WoT Scripting API in multiple programming languages. The interface definitions are specified in [[!WEBIDL]].
    </p>
    <p>
      The user agent (UA) may be implemented in the browser, or in a separate runtime environment, such as [Node.js](https://nodejs.org/en/) or small embedded runtimes.
    </p>
    <p>
      Implementations that use ECMAScript executed in a browser to implement the APIs defined in this document MUST implement them in a manner consistent with the ECMAScript Bindings defined in the Web IDL specification [[!WEBIDL]].
    </p>
    <p>
      Implementations that use TypeScript or ECMAScript in a runtime to implement the APIs defined in this document MUST implement them in a manner consistent with the TypeScript Bindings defined in the TypeScript specification [[!TYPESCRIPT]].
    </p>
    <p>
      This document serves a general description of the WoT Scripting API. Language and runtime specific issues are discussed in separate extensions of this document.
    </p>
  </section>

  <section class="appendix" id="Changes"><h2>Changes</h2>
    <p>
      The following is a list of major changes to the document. For a complete list of changes, see the [github change log](https://github.com/w3c/wot-scripting-api/commits/master). You can also view the [recently closed bugs](https://github.com/w3c/wot-scripting-api/issues?page=1&amp;state=closed).
    </p>
  </section>

  <section> <h3 class="appendix" id="openissues">Open issues</h3>
    <p>
      The following problems are being discussed and need most attention:
    </p>
      <ul>
        <li>
          Revised API for tracking the <a>TD</a> better (https://github.com/w3c/wot-scripting-api/issues/96).
        </li>
        <li>
          Security related metadata (https://github.com/w3c/wot-scripting-api/issues/91).
        </li>
        <li>
          Defining <code>DataSchema</code> better (https://github.com/w3c/wot-scripting-api/issues/89).
        </li>
        <li>
          Providing <a>Protocol Binding</a> for <a>ExposedThing</a> (https://github.com/w3c/wot-scripting-api/issues/45).
        </li>
        <li> Retrieving information from Thing Description (https://github.com/w3c/wot-scripting-api/issues/38) </li>
        <li> Script management and runtime related issues (https://github.com/w3c/wot-scripting-api/issues/) </li>
      </ul>
  </section>

  <section> <h2>Acknowledgements</h2>
    <p>
      Special thanks to former editor Johannes Hund (until August 2017, when at Siemens AG) for developing this specification. Also, the editors would like to thank Dave Raggett, Matthias Kovatsch, Michael Koster and Michael McCool for their comments and guidance.
    </p>
  </section>

  </body>
</html>
